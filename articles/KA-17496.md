---
title: 分析异常存储库增长
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager 6.4,Experience Manager 6.5
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 9:42:02 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:45:04 PM
version-number: 1
article-number: KA-17496
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=6654cfb6-b732-ec11-b6e5-000d3a5ba97a
exl-id: 51d503fe-3da6-4cfc-a8c5-95f80da51ae8
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '534'
ht-degree: 0%

---

# 分析异常存储库增长

## 描述


AEM服务器上的磁盘使用率异常且快速增加。
<br><br><br><br>原因<br><br><br><br><br><br>
许多情况可能会导致磁盘利用率异常提高。  一些潜在原因：

1. 系统上未运行正确的维护。  请参阅 [本文](https://helpx.adobe.com/experience-manager/kb/AEM6-Maintenance-Guide.html) 以详细了解各种系统维护活动。
2. AEM或应用程序正在创建大量节点或对节点属性的更新。  这可能是由于配置错误或应用程序代码错误所致。  由于Oak中的tar存储以仅附加模式运行，因此重复保存节点会进一步导致存储库的过度增长。
3. 已将超大文件上传到AEM Assets或包管理器。
4. 已启用调试或跟踪日志记录。



## 分辨率

A.如果AEM正在运行，并且磁盘空间充足<br><br><br><br> <br><br>1. 配置OAK写入TRACE日志<br><br><br><br> <br><br>如果AEM仍在运行，我们可以启用调试日志记录器来告诉我们要写入哪些存储库路径。  要启用此日志记录器，请在下面安装附加的日志配置包或按照以下步骤操作：
1. 转到 <b>*http://aemhost:port*/system/console/slinglog</b>
2. 单击 <b>[!UICONTROL 添加新的日志记录器]</b>
3. 配置日志记录器： <b>[!UICONTROL 日志文件]: `logs/repgrowth.log`</b>, <b>[!UICONTROL 日志级别]: `trace`</b>, <b>[!UICONTROL 记录器]:</b> <b>`org.apache.jackrabbit.oak.jcr.operations.writes`</b>


下载
[获取文件](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/analyze-unusual-repository-growth/jcr:content/main-pars/download/log_repository_growth-1.zip "log_repository_growth-1.zip") <br><br>此包包含Oak日志写入会话所需的配置。 通过CRX包管理器安装此包。 在您的监视期间后，请确保卸载包。<br><br><br><br><br><br><br><br> <br><br><br><br><br><br> <br><br><br><br><br><br><br><br><br>
注意：

- 日志包含有关所有写入和会话详细信息的信息。  如果您使用此日志记录器，请确保您有足够的磁盘空间。
- 在短时间内启用日志配置包或删除日志配置以避免进一步占用磁盘空间。



<br><br><br><br> <br><br>2. 运行磁盘使用情况报告<br><br><br><br> <br><br>
您还可以利用 [!UICONTROL 磁盘使用情况] 报告 <b>*http://host:port*/etc/reports/diskusage.html</b>。此报表显示存储库路径使用的磁盘空间。  报表是可钻取的，也允许您查看子树。
<br><br><br><br> <br><br>3. 捕获线程转储并执行分析<br><br><br><br> <br><br>
使用 <b>[repgrowt.log](https://helpx.adobe.com/experience-manager/kb/analyze-unusual-repository-growth.html#repgrowth)</b> 为了了解正在写入哪些数据，我们可以通过捕获线程转储和运行CPU分析来获取有关正在写入数据的代码的信息。

请参阅以下文章：

- [CPU分析](https://helpx.adobe.com/experience-manager/kb/AnalyzeUsingBuiltInProfiler.html)
- [捕获线程转储](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html)
- [分析AEM线程转储](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html)

<br><br><br><br> <br><br>B.如果AEM停止，并且/或磁盘空间快用完<br><br><br><br> <br><br>
如果必须停止AEM以避免磁盘空间增长，请使用下面的命令进行一些初始分析。

开 [!DNL Linux] 平台，利用 <b>`du`</b> 命令列出 <b>`crx-quickstart`</b> 以及这些目录的汇总大小：

`du -h --max-depth=2 crx-quickstart`

使用 <b>`find`</b> 和 <b>`du`</b> 查找最近修改的文件并获取其大小的命令：

`find crx-quickstart -type f -mtime 1 -exec du -hs {} \; -print`

要在数据存储中查找大文件，您可以将 <b>`find`</b>, <b>`du`</b> 和 <b>`file`</b> 在 <b>`datastore`</b> 目录并自动识别其文件类型：

`find crx-quickstart/repository/datastore -type f -size +100M -exec sh -c "du -hs \"{}\"; file \"{}\"" \;`

如果发现 <b>`segmentstore`</b> 目录，则以下命令可帮助提供一些关于正在写入哪些数据的线索：

`strings data_xxxxxx.tar | egrep '.?/' | sed 's/.$//;s/.\//\//'`

---
title: “在Launch中实施Video Analytics”Adobe
description: 描述
solution: Customer Journey Analytics,Analytics
product: Customer Journey Analytics,Analytics
applies-to: "Customer Journey Analytics,Analytics"
keywords: "KCS Launch Video Analytics心率"
resolution: Resolution
internal-notes: "This implementation discussed in this article does not use Adobe Launch extension for Media Analytics."
bug: false
article-created-by: Krunal Oza
article-created-date: "9/16/2022 9:07:03 AM"
article-published-by: Krunal Oza
article-published-date: "9/16/2022 9:25:26 AM"
version-number: 3
article-number: KA-15023
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee0b6fe9-9e35-ed11-9db1-002248086a9c"
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1055'
ht-degree: 0%

---

# 在Launch中实施Video AnalyticsAdobe

## 描述

<br>环境<br><br>


本文提供了使用媒体心率SDK在Launch中实施YouTube视频跟踪的步骤。


<br><br>问题/症状<br><br>
<b>先决条件</b>


| <ol>   <li>您有一个活动的AdobeLaunch实施。</li>   <li>报表包已启用媒体收集功能。</li>   <li>报表包已映射到Adobe Experience Cloud中正确的Analytics登录公司。</li>   <li>您在Launch中具有发布权限。Adobe</li>   <li>您熟悉AdobeLaunch UI及其工作方式。</li>  </ol><br> |
| --- |



## 分辨率


<b>步骤1:创建新规则</b>

通过单击“Rules”选项卡下的“添加规则”按钮，在AdobeLaunch属性中创建新规则。 此规则将包含用于加载YouTube视频以及Video Analytics和YouTube iFrame API脚本的事件条件。

- 在“名称”(Name)文本框中指定规则名称。




<b>步骤2:添加事件和/或条件</b>

单击事件和条件下的+按钮以创建条件以启动YouTube视频。 在我的示例中，我添加了一个条件“元素存在”来查找特定的div“播放器”以启动YouTube视频。



<b>步骤3:添加操作 — 配置变量</b>

单击操作下的+按钮以创建新的操作项。 这将用作设置Video Analytics变量的单点配置。 我用了一些硬编码的值。 但是，您可以使用数据元素来填充这些变量。

1. 从扩展下拉菜单中选择“Core”。
2. 从操作类型下拉菜单中选择“自定义代码”。
3. 在“名称”文本框中添加操作名称。
4. 在语言下选择“Javascript”。
5. 选中“全局执行”。
6. 单击“Open Editor”。
7. 添加代码并单击保存。 确保根据您的公司和报表包更新值。



```
(function() {    'use strict';
    // Export symbols.
    window.Configuration = {
        PLAYER: {
            NAME: 'sample player name'
            //VIDEO_ID: 'sample video id',
           //VIDEO_NAME: sample video name'
        },
        VISITOR: {
            MARKETING_CLOUD_ORG_ID: 'experience cloud ID',
            TRACKING_SERVER: 'tracking server',
            DPID: '',
            DPUUID: ''
        },
        APP_MEASUREMENT: {
            RSID: 'report suite id',
            TRACKING_SERVER: 'tracking server',
            PAGE_NAME: 'page name',
            CHAR_SET: 'UTF-8'
        },
        HEARTBEAT: {
            TRACKING_SERVER: 'heartbeat tracking server',
            PUBLISHER: 'publisher id',
            CHANNEL: 'channel',
            OVP: 'ovp name',
            SDK: 'sgk version',
       SSL: 'false',
       DEBUG: 'true'
        }
    };
})();
```


(function(){ &#39;use strict&#39;;    //导出符号。
    window.Configuration = { PLAYER:{名称：“示例播放器名称” //VIDEO_ID:“示例视频id”， //VIDEO_NAME:示例视频名称&#39; }，访客：{ MARKETING_CLOUD_ORG_ID:“experience cloud ID”，TRACKING_SERVER:“跟踪服务器”，DPID:&quot;, DPUUID:&quot; }, APP_MEASUREMENT:{ RSID:“报表包id”，TRACKING_SERVER:“跟踪服务器”，PAGE_NAME:“page name”，CHAR_SET:“UTF-8” }，心率：{ TRACKING_SERVER:“心率跟踪服务器”，发布者：“publisher id”，渠道：“channel”，OVP:“ovp name”，SDK:“sgk版本”，SSL:“false”，调试：&#39;true&#39; } } };})();



<b>步骤4:添加操作访客ID服务</b>

Media Analytics需要访客ID服务的实例。 您需要从Adobe Analytics UI的代码管理器中下载访客ID服务代码。

下载访客ID服务代码后，单击操作下的+按钮以创建新的操作项，然后

1. 从扩展下拉菜单中选择“Core”。
2. 从操作类型下拉菜单中选择“自定义代码”。
3. 在“名称”文本框中添加操作名称。
4. 在语言下选择“Javascript”。
5. 选中“全局执行”。
6. 单击“Open Editor”。
7. 在底部，添加以下代码并单击保存。
8. 在底部，添加以下代码并单击保存。


var visitor = Visitor.getInstance(&quot;Experience CloudID&quot;, { trackingServer:&quot;tracking server&quot;, //与s.trackingServer trackingServerSecure相同：&quot;跟踪服务器&quot; //与s.trackingServerSecure }相同);

<b>步骤5:添加操作 — Appmeasurement代码</b>

Media Analytics需要Appmeasurement的实例。 您需要从Adobe Analytics UI的代码管理器中下载它。

下载Appmeasurement代码后，单击操作下的+按钮以创建新的操作项，然后

1. 从扩展下拉菜单中选择“Core”。
2. 从操作类型下拉菜单中选择“自定义代码”。
3. 在“名称”文本框中添加操作名称。
4. 在语言下选择“Javascript”。
5. 选中“全局执行”。
6. 单击“Open Editor”。
7. 添加访客ID服务代码。
8. 在顶部，添加以下代码并单击保存。

<br><br><br>//初始化AppMeasurement
<br>var s_account=&quot;report suite id&quot;
<br>var s=s_gi(s_account)
<br>/\*\*\*\*\*\*\*\*\*访客ID服务配置 — 需要VisitorAPI.js \*\*\*\*\*\*\*/
<br>s.visitor=Visitor.getInstance(&quot;Experience CloudID&quot;)<br><br><br>
<b>步骤6:添加操作 — 心率代码</b>

从下载心率SDK [https://github.com/Adobe-Marketing-Cloud/media-sdks/tree/master/sdks/js/libs](https://github.com/Adobe-Marketing-Cloud/media-sdks/tree/master/sdks/js/libs).

下载心率代码后，单击操作下的+按钮以创建新的操作项，然后

1. 从扩展下拉菜单中选择“Core”。
2. 从操作类型下拉菜单中选择“自定义代码”。
3. 在“名称”文本框中添加操作名称。
4. 在语言下选择“Javascript”。
5. 选中“全局执行”。
6. 单击“Open Editor”。
7. 添加访客ID服务代码。
8. 在底部，添加以下代码并单击保存。


//创建对MediaHeartbeat类的本地引用

var MediaHeartbeat = ADB.va.MediaHeartbeat;var MediaHeartbeatConfig = ADB.va.MediaHeartbeatConfig;var MediaHeartbeatDelegate = ADB.va.MediaHeartbeatDelegate;

//媒体心率初始化

var mediaConfig = new MediaHeartbeatConfig();mediaConfig.trackingServer = Configuration.HEARTBEAT.TRACKING_SERVER;mediaConfig.playerName = Configuration.PLAYER.NAME;mediaConfig.channel = Configuration.HEARTBEAT.CHANNEL;mediaConfig.debugLogging = Configuration.HEARTBEAT.DEBUG;

mediaConfig.appVersion = Configuration.HEARTBEAT.SDK;mediaConfig.ssl = Configuration.HEARTBEAT.SDK;mediaConfig.ovp = Configuration.HEARTBEAT.OVP;

//实施MediaHeartbeatDelegate协议。
var mediaDelegate = new MediaHeartbeatDelegate();

// 初始化

var appMeasurement = new AppMeasurement();appMeasurement.visitor = visitor;appMeasurement.trackingServer = Configuration.APP_MEASUREMENT.TRACKING_SERVER;appMeasurement.account = Configuration.APP_MEASUREMENT.RSID;appMeasurement.pageName = Configuration.APP_MEASUREMENT.PAGE_NAME;appMeasurement.charSet = Configuration.APP_MEASUREMENT.CHAR_SET;var contextData = { pageURL:document.URL， isUserLoggedIn:&quot;false&quot;, tvStation:《电视台样例》，程序员：&quot;库尔希德阿拉姆&quot; };var mediaInfo;var videostarted = false;var metaDataLoaded = false;



<b>步骤7:添加操作 — YouTube IFrame API代码</b>

1. 从扩展下拉菜单中选择“Core”。
2. 从操作类型下拉菜单中选择“自定义代码”。
3. 在“名称”文本框中添加操作名称。
4. 在语言下选择“Javascript”。
5. 选中“全局执行”。
6. 单击“Open Editor”。
7. 添加以下代码并单击保存。


// 2. 此代码异步加载IFrame播放器API代码。

var tag = document.createElement(&#39;script&#39;);tag.src = &quot;https://www.youtube.com/iframe_api&quot;;var firstScriptTag = document.getElementsByTagName(&#39;script&#39;)0;firstScriptTag.parentNode.insertBefore(tag， firstScriptTag);

// 3. 此函数在API代码下载后创建一个iframe(和YouTube播放器)//。

var播放器；函数onYouTubeIframeAPIReady(){ console.log（&quot;onYouTubeIframeAPIReady已调用……&quot;）；       player = new YT.Player(&#39;player&#39;, { height:“390”，宽度：“640”，videoId:“xWYHvIjvMnY”，事件：{ &#39;onReady&#39;:onPlayerReady， &#39;onStateChange&#39;:onPlayerStateChange， &#39;onPlaybackQualityChange&#39;:onPlayerPlaybackQualityChange， &#39;onPlaybackRateChange&#39;:onPlayerPlaybackRateChange， &#39;onError&#39;:onPlayerError });}

// 4. 视频播放器准备就绪后，API将调用此函数。

function onPlayerReady(event){ metaDataLoaded = true;       player.playVideo();}

// 5. 当播放器状态发生更改时，API会调用此函数。
//函数指示在播放视频(state=1)时， //播放器应播放6秒，然后停止。

function onPlayerStateChange(event){ switch(event.data){ case YT.PlayerState.PLAYING:  console.log（&quot;\*\*\*HB正在播放&quot;）；                     if(metaDataLoaded){ if(Math.floor(event.target.getCurrentTime())== 0){ console.log(&quot;\*\*\*HB Start&quot;);                                   MediaHeartbeat = ADB.va.MediaHeartbeat;                                   mediaInfo = MediaHeartbeat.createMediaObject(event.target.getVideoData()。title， event.target.getVideoData()。video_id， Math.floor(event.target.getDuration()), MediaHeartbeat.StreamType.VOD);                                     MediaHeartbeat = new MediaHeartbeat(mediaDelegate， mediaConfig， appMeasurement);                                   mediaDelegate.getCurrentPlaybackTime = function(){返回Math.floor(event.target.getCurrentTime());                           };                                   MediaHeartbeat.trackSessionStart(mediaInfo， contextData);                                   MediaHeartbeat.trackPlay();                                   videostarted = true;                     } else { console.log（&quot;\*\*\*HB播放&quot;）；                           MediaHeartbeat.trackPlay();                     }}中断；              YT.PlayerState.PAUSED案例：                     console.log（&quot;\*\*\*HB暂停&quot;）；                     MediaHeartbeat.trackPause();                     中断；              case YT.PlayerState.ENDED:                     console.log（&quot;\*\*\*HB已结束&quot;）；                     MediaHeartbeat.trackComplete();                     MediaHeartbeat.trackSessionEnd();                     中断；              用例–1:                     console.log（&quot;\*\*\*HB已卸载&quot;）；                     MediaHeartbeat.trackComplete();                     MediaHeartbeat.trackSessionEnd();                     中断；       }

}

函数onPlayerPlaybackQualityChange(event){ console.log(&quot;onPlayerPlaybackQualityChange:event.data:&quot;+ event.data);}

函数onPlayerPlaybackRateChange(event){ console.log(&quot;onPlayerPlaybackRateChange:event.data:&quot;+ event.data);}

函数onPlayerError(event){ console.log(&quot;onPlayerError:event.data:&quot;+ event.data);}



<b>步骤8:添加HTML</b>

在您的HTML代码中添加以下代码。

!-- 1. iframe（和视频播放器）将替换此div标记。 — div id=&quot;player&quot;/divbr

<b>步骤8:发布</b>

发布您的资产并进行测试。



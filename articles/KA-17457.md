---
title: "常见关键AEM问题"
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Victoria Barnato
article-created-date: "2/22/2023 9:05:10 PM"
article-published-by: Victoria Barnato
article-published-date: "4/3/2023 8:05:17 PM"
version-number: 7
article-number: KA-17457
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d9614f94-f4b2-ed11-83fe-6045bd0067ea"
source-git-commit: b54e9cc097e838cf9033e85ca2b7d5e1e636f4ad
workflow-type: tm+mt
source-wordcount: '1930'
ht-degree: 4%

---

# 常见关键AEM问题

## 描述 {#description}


本文介绍了最常见的AEM关键问题及其分析方法。

- AEM Sites性能
- AEM Assets性能
- 内存问题
- 索引问题
- 复制问题
- TarMK损坏问题



## 解决方法 {#resolution}

AEM Sites性能问题<br>
<b>性能问题的症状</b>

1. 页面加载缓慢
2. 页面的创建或编辑速度缓慢
3. AEM响应时间较慢
4. AEM没有响应某些请求
5. AEM上的request.log显示响应缓慢


<b>导致性能问题的原因</b>

1. 线程争用 — 长时间运行的请求，如慢速搜索、写入密集型后台作业、移动网站内容的整个分支等。
2. CPU利用率高
3. 昂贵的请求，如昂贵的搜索或低效的应用程序代码、组件等。
4. 缺乏适当的维护
5. 调度程序缓存不足
6. 缺少CDN
7. 缺少浏览器缓存
8. 页面上加载并页面顶部加载的脚本过多
9. CSS在整个页面中加载，而不是在HTML头中加载
10. 服务器大小不足或架构不正确
11. 内存问题（请参阅下文）


<b>如何分析性能问题</b>

1. [捕获一系列线程转储](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html) 和 [分析](https://helpx.adobe.com/cn/experience-manager/kb/thread-dump-analysis.html).
2. 如果AEM java进程导致CPU利用率较高，请在操作系统级别检查：    
   - Linux:使用top命令检查CPU利用率。
   - 窗口：使用Windows任务管理器

    如果AEM导致CPU利用率较高，请运行现成的分析工具几分钟并分析结果。
3. [分析request.log文件中是否存在任何慢速请求](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/monitoring-and-maintaining.html?lang=en#interpreting-the-request-log).
4.查看系统维护过程。 请参阅 [文章](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/monitoring-and-maintaining.html)有关AEM维护的详细信息，并确保您对AEM进行正确维护，包括： — 修订清理（仅限MongoMK和Database DocumentNodeStore） — 每日或更频繁的离线焦油压缩（仅限TarMK） — 每两周 — 数据存储垃圾收集（仅限具有FileDataStore或S3 DataStore的系统） — 每周 — 工作流清除 — 每周 — 版本清除 — 每周 — 审核日志清除 — 每周5。查看在AEM级别实施的缓存策略。
6.查看网站的缓存。
7.使用客户端站点分析工具，例如 <b>审核</b> Google Chrome浏览器中的功能 <b>开发人员工具</b> 的上界。  这些工具将为您提供有关客户端性能改进的建议。


<b>常见性能问题的解决方案</b>

- 请参阅 [本文](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17486.html) 以详细了解如何优化性能。
- 查看 [性能调整提示](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17466.html)

<br> AEM Assets性能问题<br> 
<b>资产性能问题的症状</b>

- 将文件上传到/assets.html或/damadmin UI速度缓慢
- 缩略图的生成时间过长
- 移动、删除、编辑和元数据更新等资产操作需要过长时间


<b>资产性能问题的原因</b>

- 缺乏适当的维护
- 未应用最新的修补程序包
- 未应用优化
- 用户负载的服务器大小不足


<b>如何分析资产性能问题</b>

- [在以上网站性能分析中查看步骤1-4](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17457.html#performance-analysis).

<b>常见资产性能问题的解决方案</b>
- 查看 [AEM Assets性能调整指南](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/assets-performance-sizing.html?lang=en).
- 可以找到一些问题情景的解决方案及其解决方案 [此处](https://helpx.adobe.com/experience-manager/kb/comon-aem-assets-ingestion-issues.html).
- 调整资产处理性能，请参阅 [本文](https://helpx.adobe.com/experience-manager/kb/Asset-Performance-Tuning.html).

<br>内存问题<br>
<b>内存问题症状</b>

- AEM随机崩溃，并在日志中观察到OutOfMemoryError
- AEM会随着时间的推移而变慢，最终崩溃
- AEM无响应


<b>诊断内存问题</b>

- 搜索日志文件以查找OutOfMemoryError，如果发现任何匹配项，则会出现内存问题
- 查看http://*aem-host:port*/system/console/memoryusage屏幕

   如果“旧代”（JDK 7及更早版本）或“终身生成”（JDK8或更高版本）的使用率很高，则这可能表示堆内存利用问题。  单击“运行垃圾收集器”以请求JVM运行完整的堆垃圾收集。  如果请求GC后堆利用率保持高，则可能会出现问题。  在具有Oak Tar存储的AEM实例上，如果实际使用量高于3GB，则可能会出现问题。  具有Mongo存储的系统上的堆利用率较高可能是由于内存中的缓存配置所致。
- [获取线程转储和顶部输出](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html#) 执行 [线程分析](https://helpx.adobe.com/cn/experience-manager/kb/thread-dump-analysis.html).  检查导致CPU利用率高的线程是否为本机JVM垃圾收集线程。  如果使用最多CPU时间的线程是“VM线程”或任何垃圾收集线程，则可能会出现内存问题。


<b>导致内存问题的原因</b>

- Java应用程序内存泄漏
- 由于在自定义代码中使用最终定稿不正确，Java终结器会累积
- 最大堆配置不足


<b>如何分析内存问题的原因</b>

请参阅 [本文](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17482.html) 有关如何捕获堆转储的详细信息。

确定内存问题原因的最佳方法是分析堆转储。

捕获堆转储文件后，在 [Eclipse MAT](http://www.eclipse.org/mat/) 或 [IBM Memory Analyzer](https://developer.ibm.com/languages/java/) 工具。  在Eclipse MAT中，运行泄漏可疑报告并打开“线程详细信息”视图，以查看内存问题的潜在原因。

<b>常见内存问题的解决方案</b>

- 如果您发现垃圾收集暂停时间较长，请优化应用程序代码以减少内存的使用。  大多数垃圾收集问题最好通过优化应用程序而不是调整JVM来解决。
- 如果您已经优化了应用程序，但仍经历较长的GC暂停，则 [重点调整JVM](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/).

<br>AEM索引问题<br>
<b>索引问题的症状</b>

以下是AEM/Oak索引出现问题的迹象：

- 搜索结果已过时10分钟以上
- 缺少搜索结果
- 通过站点UI、查询生成器搜索或JCR查询执行搜索期间，在UI或日志中返回错误

<b>诊断索引问题</b>
要查看异步索引是慢速还是失败，请执行以下操作：
1. 在AEM实例中打开这些URL以查看有关异步索引器http://aemhost:port/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3Dasync%2Ctype%3DIndexStats http://aemhost:port/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3Dfulltext-async%2Ctype%3DIndexStats  - This URL仅适用于AEM6.2及更高版本的统计资料
2. 在每个页面上，检查以下字段：

   <b>失败时间</b>  — 这表示索引首次开始失败的时间。

   <b>LastError</b>  — 这是堆栈跟踪，显示导致索引失败的原因。  如果此值为空，则索引不会失败。

   <b>LastErrorTime</b>  — 这表示上次索引引发错误的时间。

   <b>LastIndexedTime</b>  — 如果此字段的日期和时间超过5分钟，则索引运行太慢。


<b>索引出现问题的原因</b>

- 维护不当或无法执行维护失败，例如修订垃圾收集、工作流清除、审核清除、版本清除等。
- Tar存储中损坏或缺少区段
- 群集环境（DocumentNodeStore - Mongo或数据库）中的修订损坏
- 群集环境中的群集拓扑存在问题


<b>如何分析导致索引问题的原因</b>

- 请参阅 [本文](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17492.html) 用于分析和修复索引问题

<br>复制问题<br>
<b>复制问题症状</b>

- 发布请求在复制代理队列中排队
- 发布内容在发布服务器上不显示
- 对系统性能的影响


<b>导致复制问题的原因：</b>

- 复制代理配置错误，无法连接到发布代理
- 复制时出错，导致复制队列卡住
- 系统运行缓慢，复制处理缓慢
- 复制作为自定义工作流的一部分进行，问题在于工作流处理。


<b>如何分析复制问题：</b>

1. 检查复制队列 [状态](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/replication.html?lang=zh-Hans):

   <b>活动：</b> 处理项目时。

   <b>空闲：</b> 队列为空时。

   <b>已阻止：</b> 项目在队列中，但无法处理时；例如，当代理指向某个已关闭或不存在的主机时。
2. 如果您的服务器已克隆或代理最近已配置，请查看复制配置。 有关详细信息，请参阅 [此处](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/replication.html?lang=en#configuring-your-replication-agents-from-the-author-environment).
3. 在以下位置查看复制代理日志： <b>http://host:port/etc/replication/agents.author/AgentName.log.html#end</b>.  如果无法识别任何项目，则收集此日志并提供给AEM支持。
4. 从查看服务器error.log <b>AEMinstall/crx-quickstart/logs</b>;如果无法识别任何项目，则收集此日志并提供给AEM支持。
5. 如果复制队列处于“空闲”状态，且上述情况均不适用，则在这种情况下，问题极有可能是由工作流造成的。 如果未处理工作流，则复制项永远不会进入复制队列。 要监控工作流的状态，您可以检查工作流仪表板以检查正在运行的工作流实例数。 您可以阅读有关管理工作流的信息 [此处](https://experienceleague.adobe.com/docs/experience-manager-65/administering/operations/workflows.html).
6. 当系统处于高负载或遇到其他性能问题时，复制速度会减慢。


<b>常见复制问题的解决方案：</b>

1) [查看复制队列问题](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17467.html)
2)如果问题是由于工作流运行效率不高，您可以查看并发 [工作流处理提示](https://experienceleague.adobe.com/docs/experience-manager-65/developing/extending-aem/extending-workflows/workflows-process-ref.html?lang=en)
<br>TarMK损坏问题<br>
<b>TarMK损坏症状</b>

- 离线压缩后，实例无法运行。
- 实例卡在中 <b>正在启动</b> 状态。
- 日志文件或压缩命令输出报告 <b>SegmentNotFoundException</b>.


<b>导致腐败问题的原因</b>

- 通过手动干预（如rm -rf）删除该区段。
- 该区段将通过修订垃圾收集来删除，或者由于代码中存在某些错误而找不到该区段。
- 由于代码中的一些错误，无法找到该区段。
- 不会按时执行各种维护任务，从而导致存储库增长和磁盘空间不足。
- 通过终止java进程来强制停止AEM。


<b>诊断存储库损坏问题：</b>

- 查看error.log文件并检查是否存在 <b>SegmentNotFoundException</b> 或 <b>IllegalArgument异常</b>.
- 要确定某个区段是否已通过修订版垃圾收集删除，请检查org.apache.jackrabbit.oak.plugins.segment.file.TarReader-GC（启用调试日志）记录器的输出。 该日志记录器记录清理阶段删除的所有区段的区段ID。 只有当违规区段id显示在该日志记录器的输出中时，修订垃圾收集才是异常的原因。
- 如果外部数据存储损坏，请搜索日志文件以查找所有出现错误的情况 <b>获取blobId的InputStream时出错</b>. 此错误表示您的AEM数据存储目录中缺少文件。


<b>修复损坏问题的解决方案：</b>

- 使用 [check](https://github.com/apache/jackrabbit-oak/blob/trunk/oak-run/README.md#check) oak-run的运行模式。  手动将损坏的区段存储还原到其最新良好修订版。 此操作会及时将Oak存储库还原到以前的状态。  在执行此操作之前，您应该完全备份存储库。
   - 要执行检查和恢复，请按照 [本文](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-16542.html).
   - 如果检查失败，则使用 <b>ConsistencyChecker — 未找到良好的修订版本</b> 然后在 [本文](https://helpx.adobe.com/experience-manager/kb/offline-compaction-fails-with-SegmentNotFoundException-and-IllegalArgumentException.html).
- 如果您没有使用数据存储，请使用外部文件S3或Azure数据存储，而不是默认的segmentstore。
   - 使用数据存储可提供更好的性能。
   - 使用将实例迁移到具有数据存储的实例 [crx2oak](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/upgrading/using-crx2oak.html?lang=en).
- 应用最新的Service Pack和累积修补程序包以及Oak累积修补程序包。




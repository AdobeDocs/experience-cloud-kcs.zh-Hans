---
title: “AEM 线程转储分析”
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html"
bug: false
article-created-by: Emily Geary
article-created-date: "3/17/2021 9:11:03 PM"
article-published-by: Emily Geary
article-published-date: "3/17/2021 9:13:37 PM"
version-number: 2
article-number: KA-16458
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e70a8345-6587-eb11-a812-000d3a593216"
exl-id: 74bb70e4-a09b-48fc-8378-96a1736e5ebf
source-git-commit: a59847e2e7e37f432cb01150b9444cd9dbf585df
workflow-type: tm+mt
source-wordcount: '1000'
ht-degree: 100%

---

# AEM 线程转储分析

## 描述

使用 [IBM 线程分析器](http://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c)工具分析 AEM [!DNL Java] 线程转储。

## 分辨率

1. 下载并安装 [IBM 线程分析器](https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c)（简称为 IBM TDA）
1. 从遇到性能问题的 AEM 实例中捕获[线程转储](https://helpx.adobe.com/cn/experience-manager/kb/TakeThreadDump.html)。
1. 在 IBM TDA 中打开线程转储。
1. 要查看线程转储的详细信息，请选择列表中的文件，然后单击“线程详细信息”按钮\*。

![tda-threaddetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1587732783/tda-threaddetail.png "tda-threaddetail")

1. 按“堆栈深度”排序，最长堆栈位于顶部。

   ![tda-image1](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image/tda-image1.png)

1. 查看堆栈深度为 10 行或更长的线程。 这些通常是人们最感兴趣的线程。 在感兴趣的线程上做笔记。
1. 按线程“状态”排序
1. 向下滚动至“可运行”线程。 可运行线程是在进行线程转储时大量占用 CPU 时间的线程。

   *注意：在查看“可运行”线程时，您可以忽略列在本页底部[可忽略线程](https://helpx.adobe.com/cn/experience-manager/kb/thread-dump-analysis.html#ignorethreads)分区的线程。*

1. 查找属于应用程序一部分的可运行线程，例如，后台作业线程或请求线程（请求线程的名称如下 *127.0.0.1 1347028187737 GET /content/sites/global/en/sitemap.static-delivery.httpd.html HTTP/1.1*）。 找到后，请一一单击这些线程。

1. 对于每个请求线程，您可以通过查看线程名称中的时间戳来了解用户的浏览器何时向服务器发出请求。 例如，在以上线程的名称中，时间戳（以自 UNIX 纪元以来所经过的毫秒数为单位）为 1347028187737。我们可以使用 [www.epochconverter.com](http://www.epochconverter.com/) 将该纪元数转换为日期/时间。每个线程转储都显示了它被占用时的日期和时间。 您可以通过请求时间和线程转储时间之间的时间差来查看请求活动的时间。

1. 查看请求线程后，滚动浏览其他“可运行”线程。 找到感兴趣的“可运行”线程后，请查看中间面板“等待线程”。 那里列出的线程正在等待所选线程释放监测器。 如果您没有看到任何等待线程，那么您选择的线程可能仍然是[锁](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html)的所有者（有关详细信息，请参见[锁](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html)的实施类）。 例如，若使用 [ReentrantReadWriteLock](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html)，则您无法分辨哪个线程是锁的持有者，因为锁在内部实施了多个监测器。因此，您可能必须查看源代码，将其与可能是锁的持有者的线程匹配。

1. 如果某个线程有许多其他线程正在等待的锁或监测器，那么请检查其余的线程转储，看看是否能找到其他有同样问题的线程。 查看其他转储中是否仍然存在相同的线程（在 IBM TDA 中，您可以选择多个线程转储并单击“比较线程”按钮\* 查看多个线程转储中的线程状态。

   ![tda-comparethreads](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1159496390/tda-comparethreads.png)

1. 请参阅以下屏幕快照中的“收集器服务”：

   ![tda-Image2](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1730877898/tda-Image2.png)

1. 在此视图中，您可以跨多个线程转储查看线程，看看它是否是长时间运行的线程。 基本上，如果线程在多个转储中处于可运行状态并且具有长堆栈，那么这通常意味着它是一个长时间运行的线程。

1. 如果您没有发现太多可运行线程，请返回线程列表，选择一个线程转储，然后单击顶部面板上的“监测详细信息”按钮\*。IBM TDA 将打开一个窗口，显示拥有线程及相应等待线程的监测器的树视图。注意：该视图可能会显示一些线程池线程，如 servlet 引擎线程池监测器，可以忽略空闲线程。 您通常可以判断某个线程是否是空闲线程池线程，因为大多数时候这类线程只有 10 个或更少的堆栈行。

![tda-monitordetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1106466084/tda-monitordetail.png)

<b>线程级别 CPU 利用率（[!DNL Linux]仅限平台）：</b>

1. 如果除了线程转储之外还捕获了“top -H -b -n1 -p javapid”输出，那么您可以交叉引用线程级别 CPU 利用率。 打开顶部输出并获取使用 CPU 的线程的进程 ID。 将进程 ID 转换为十六进制，然后在相应的线程转储文件中搜索该十六进制值。 ID 应该与其中一个线程的“nid”匹配。
1. 如果使用最多 CPU 的匹配线程是“VM 线程”或任何“GC”线程，那么您可能有内存问题。 对更多线程转储和最高输出重复相同的练习，如果这些线程的模式占用了 CPU 时间，则说明存在内存问题。
1. 如果您已确认内存问题，则请在下次出现问题时捕获堆转储。 请参阅[本文](https://helpx.adobe.com/cn/experience-manager/kb/AnalyzeMemoryProblems.html)，获得有关捕获和分析堆转储的更多详细信息。

![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)

可以忽略的线程：

- VM 线程：这是一个 VM 系统线程。
- 以 GC 任务线程开头的线程：这些是垃圾收集线程。
- java.net.PlainSocketImpl.socketAccept(Native Method) 代码中名称类似于 - 1347028691218 的线程：这些线程来自 servlet 引擎的线程池，等待新连接。

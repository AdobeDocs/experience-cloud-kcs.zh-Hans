---
title: "AEM线程转储分析"
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html"
bug: false
article-created-by: Emily Geary
article-created-date: "3/17/2021 9:11:03 PM"
article-published-by: Emily Geary
article-published-date: "3/17/2021 9:13:37 PM"
version-number: 2
article-number: KA-16458
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e70a8345-6587-eb11-a812-000d3a593216"
exl-id: 74bb70e4-a09b-48fc-8378-96a1736e5ebf
source-git-commit: a59847e2e7e37f432cb01150b9444cd9dbf585df
workflow-type: tm+mt
source-wordcount: '1000'
ht-degree: 0%

---

# AEM线程转储分析

## 描述

分析AEM [!DNL Java] 使用 [IBM线程分析器](http://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) 工具。

## 分辨率

1. 下载并安装 [IBM线程分析器](https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) (简称IBMTDA)
1. Capture [线程转储](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html) 从遇到性能问题的AEM实例。
1. 在IBM TDA中打开线程转储。
1. 要查看线程转储的详细信息，请在列表中选择文件，然后单击“线程详细信息”按钮\*。

![tda-threaddetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1587732783/tda-threaddetail.png "tda-threaddetail")

1. 按“堆叠深度”排序，顶部堆叠最长。

   ![tda-image1](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image/tda-image1.png)

1. 查看堆栈深度为10行或更长的线程。  这通常是最感兴趣的线索。  对感兴趣的线程进行注释。
1. 按线程“状态”排序
1. 向下滚动到“可运行”线程。 可运行线程是在进行线程转储时主动占用CPU时间的线程。

   *注意：查看“可运行”线程时，可以忽略 [可忽略的线程](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html#ignorethreads) 部分。*

1. 查找属于应用程序一部分的可运行线程，例如后台作业线程或请求线程（请求线程具有如下名称） *127.0.0.1 1347028187737GET/content/sites/global/en/sitemap.static-delivery.httpd.html HTTP/1.1*)。 找到它们后，逐一单击它们。

1. 对于每个请求线程，您可以通过查看线程名称中的时间戳来了解用户的浏览器何时向服务器发出请求。  例如，在上述线程名称中，时间戳（以毫秒unix纪元格式）为1347028187737。  我们可以使用 [www.epochconverter.com](http://www.epochconverter.com/).  每个线程转储都显示执行该转储的日期和时间。  您可以利用请求时间和线程转储时间之间的时间差，查看请求处于活动状态的时长。

1. 查看请求线程后，滚动浏览其他“可运行”线程。  找到“可运行”的目标线程后，请查看中间面板“等待线程”。  列出的线程正在等待所选线程释放监视器。  如果您没有看到任何等待线程，则您选择的线程仍可能是 [锁](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) (请参阅实施类 [锁](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) )。 例如，使用 [ReentrantReadWriteLock](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html) 当锁定在内部实施多个监视器时，您无法判断哪个线程是锁定器。  因此，您可能需要查看源代码，以将其与可能是锁持器的线程进行匹配。

1. 如果线程具有锁或监视器，许多其他线程正在等待，则请检查线程转储的其余部分，以查看您是否可以找到存在相同问题的其他线程。  查看同一线程是否仍存在于其他转储中(在IBM TDA中，您可以选择多个线程转储，然后单击“比较线程”按钮\*以查看跨多个线程转储的线程状态。

   ![tda-comparethreads](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1159496390/tda-comparethreads.png)

1. 请参阅以下屏幕截图中的收集器服务：

   ![tda-Image2](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1730877898/tda-Image2.png)

1. 在此视图中，您可以查看跨多个线程转储的线程，以查看它是否是一个长时间运行的线程。  基本上，如果线程在多个转储中处于“可运行”状态，且堆栈较长，则通常意味着它是运行较长的线程。

1. 如果您在查看可运行线程时没有发现多少内容，请返回到线程列表，选择一个线程转储，然后单击顶部面板上的“监视器详细信息”按钮\*。 IBM TDA将打开一个窗口，其中显示监视器所属线程及其等待线程的树视图。 注意：它可能显示一些线程池线程（如servlet引擎线程池监视器），空闲线程可能被忽略。  通常可以判断线程是空闲线程池线程，因为大多数情况下它们只有10条或更少的堆栈行。

![tda监控详细信息](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1106466084/tda-monitordetail.png)

<b>线程级CPU利用率([!DNL Linux] 仅平台):</b>

1. 如果除了线程转储外还捕获了“top -H -b -n1 -p javapid”输出，则可以交叉引用线程级别的CPU利用率。  打开顶部输出并获取正在利用CPU的线程的进程ID。  将进程ID转换为十六进制值，然后在相应线程转储文件中搜索该十六进制值。  id应与其中一个线程的“nid”匹配。
1. 如果使用最多CPU的匹配线程是“VM线程”或任何“GC”线程，则您可能遇到内存问题。  对更多线程转储和顶部输出重复相同的练习，如果这些线程的模式占用CPU时间，则会出现内存问题。
1. 如果已确认内存问题，则下次出现问题时捕获堆转储。  请参阅 [本文](https://helpx.adobe.com/experience-manager/kb/AnalyzeMemoryProblems.html) 有关捕获和分析堆转储的更多详细信息。

![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)

可忽略的线程：

- 虚拟机线程：这是VM系统线程。
- 以GC任务线程开头的线程：这些是垃圾收集线程。
- 名称类似于 — 1347028691218的线程(位于java.net.PlainSocketImpl.socketAccept(Native Method)):这些是Servlet引擎线程池中的线程，等待新连接。

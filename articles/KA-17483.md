---
title: 只读文件
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:23:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:18:00 PM
version-number: 1
article-number: KA-17483
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=88d504a5-9332-ec11-b6e5-000d3a5ba97a
exl-id: ccc49009-5cc4-48d5-84a3-3f7283afb1ca
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '867'
ht-degree: 1%

---

# 只读文件

## 描述

文档将描述哪些文件被锁定在中且不要更改，以及如何正确设置所需的配置设置。<br><br> <br><br><br><br><br>为什么？<br><br><br><br> <br><br>
当AMS设置系统时，它们会推出基线配置，使所有功能都能够正常运行并且安全。  AMS并不希望将这些作为功能和安全性的基准。  要完成此操作，某些文件会被标记为只读和不可变，以避免您更改它们。

布局不会阻止您更改其行为并覆盖您需要的任何更改。  您将覆盖自己的文件，取代原始文件，而不是更改这些文件。

这样，您就可以放心，当AMS为调度程序添加补丁时，调度程序会使用最新的修复和安全增强功能，以便它们不会更改您的文件。  然后，您可以继续从这些改进中受益，并仅采用所需的更改。
![展示了一个保龄球道，球在车道上滚动。  球上有一个箭头，上面写着“你”。  排水沟阻塞器被抬起，上面有“不可改变的文件”字样。](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/bowling-file-immutability.png "bowling-file-immunitable")<br><br><br><br> <br><br>
如上图所示，不可变文件不会阻止您玩游戏。  他们只是阻止你伤害你的表演，让你留在车道上。  此方法允许我们使用以下几个非常关键的功能：

- 自定义操作在其自己的安全空间中进行处理
- 自定义更改的叠加反映了AEM中叠加方法的叠加
- 可以在不更改自定义的情况下对AMS配置进行修补
- 测试基本安装与自定义配置可以同时完成，以帮助确定问题是由自定义还是其他原因引起

<br><br><br><br>哪些文件？<br><br><br><br> <br><br>
以下是与调度程序一起部署的典型文件列表：
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/``├── conf``│   └── httpd.conf``├── conf.d``│   ├── available_vhosts``│   │   ├── 000_unhealthy_author.vhost``│   │   ├── 000_unhealthy_publish.vhost``│   │   ├── aem_author.vhost``│   │   ├── aem_flush.vhost``│   │   ├── aem_health.vhost``│   │   ├── aem_lc.vhost``│   │   └── aem_publish.vhost``│   ├── dispatcher_vhost.conf``│   ├── enabled_vhosts``│   │   ├── aem_author.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_author``.vhost``│   │   ├── aem_flush.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_flush``.vhost``│   │   ├── aem_health.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_health``.vhost``│   │   └── aem_publish.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost``│   ├── logformat.conf``│   ├── remoteip.conf``│   ├── rewrites``│   │   ├── base_rewrite.rules``│   │   └── xforwarded_forcessl_rewrite.rules``│   ├── security.conf``│   ├── variables``│   │   └── ams_default.vars``│   └── whitelists``│       └── 000_base_whitelist.rules``├── conf.dispatcher.d``│   ├── available_farms``│   │   ├── 000_ams_author_farm.any``│   │   ├── 001_ams_lc_farm.any``│   │   └── 999_ams_publish_farm.any``│   ├── cache``│   │   ├── ams_author_cache.any``│   │   ├── ams_author_invalidate_allowed.any``│   │   ├── ams_publish_cache.any``│   │   └── ams_publish_invalidate_allowed.any``│   ├── clientheaders``│   │   ├── ams_author_clientheaders.any``│   │   ├── ams_common_clientheaders.any``│   │   ├── ams_lc_clientheaders.any``│   │   └── ams_publish_clientheaders.any``│   ├── dispatcher.any``│   ├── enabled_farms``│   │   ├── 000_ams_author_farm.any -``/etc/httpd/conf``.dispatcher.d``/available_farms/000_ams_author_farm``.any``│   │   └── 999_ams_publish_farm.any -``/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any``│   ├── filters``│   │   ├── ams_author_filters.any``│   │   ├── ams_lc_filters.any``│   │   └── ams_publish_filters.any``│   ├── renders``│   │   ├── ams_author_renders.any``│   │   ├── ams_lc_renders.any``│   │   └── ams_publish_renders.any``│   └── vhosts``│       ├── ams_author_vhosts.any``│       ├── ams_lc_vhosts.any``│       └── ams_publish_vhosts.any``├── conf.modules.d``│   ├── 01-cgi.conf``│   └── 02-dispatcher.conf``└── modules - ../..``/usr/lib64/httpd/modules``   ``└── mod_dispatcher.so` |
| --- |


要确定哪些文件不可更改，您可以在调度程序上运行以下命令以查看：
<br><br><br><br><br> <br><br><br><br>

| 1 | `$ lsattr -Rl``/etc/httpd` `2``/dev/null` `|``grep` `Immutable` |
| --- | --- |

<br><br><br><br><br> <br><br>
以下是其文件不可更改的示例响应：
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/conf/httpd``.conf   Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_author``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_lc``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_flush``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_health``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/000_unhealthy_author``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/000_unhealthy_publish``.vhost Immutable``/etc/httpd/conf``.d``/rewrites/base_rewrite``.rules Immutable``/etc/httpd/conf``.d``/rewrites/xforwarded_forcessl_rewrite``.rules Immutable``/etc/httpd/conf``.d``/whitelists/000_base_whitelist``.rules Immutable``/etc/httpd/conf``.d``/dispatcher_vhost``.conf Immutable``/etc/httpd/conf``.d``/logformat``.conf Immutable``/etc/httpd/conf``.d``/security``.conf Immutable``/etc/httpd/conf``.modules.d``/02-dispatcher``.conf Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/000_ams_author_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/001_ams_lc_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_author_cache``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_author_invalidate_allowed``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_publish_cache``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_publish_invalidate_allowed``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_author_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_publish_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_common_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_lc_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_author_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_publish_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_lc_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_author_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_publish_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_lc_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_author_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_publish_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_lc_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/dispatcher``.any Immutable` |
| --- |



## 分辨率

<br><br>如何进行更改<br><br><br><br> <br><br>变量<br><br><br><br> <br><br>
利用变量，可在不更改配置文件本身的情况下进行功能更改。  可以通过调整变量值来调整配置的某些元素。  我们可以从文件中突出显示的一个示例 */etc/httpd/conf.d/dispatcher_vhost.conf* 如下所示：
<br><br><br><br><br> <br><br><br><br>

| `Include /etc/httpd/conf.d/variables/ams_default.vars````IfModule` &#39;disp_apache2.c``    ``DispatcherConfig conf.dispatcher.d/dispatcher.any``    ``DispatcherLog logs/dispatcher.log``    ``DispatcherLogLevel ${DISP_LOG_LEVEL}``    ``DispatcherDeliseRoot 0``    ``DispatcherUseProcessedURL 1``/``IfModule&quot;` |
| --- |

<br><br><br><br><br> <br><br>
了解 <b>DispatcherLogLevel</b> 指令具有DISP_LOG_LEVEL变量，而不是您在该变量中看到的正常值。  在代码的该部分上方，您还将看到一个包含语句到变量文件。  变量文件 */etc/httpd/conf.d/variables/ams_default.vars*是我们下一步的目标。  以下是该变量文件的内容：
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7 | `Define DISP_LOG_LEVEL info``Define AUTHOR_WHITELIST_ENABLED 0``Define PUBLISH_WHITELIST_ENABLED 0``Define LIVECYCLE_WHITELIST_ENABLED 0``Define AUTHOR_FORCE_SSL 1``Define PUBLISH_FORCE_SSL 0``Define LIVECYCLE_FORCE_SSL 1` |
| --- | --- |

<br><br><br><br><br> <br><br>
如果您看到DISP_LOG_LEVEL变量的当前值为info。  我们可以根据跟踪、调试或您选择的数字值/级别来调整此参数。  现在，控制日志级别的每个位置都将自动进行调整。
<br><br><br><br> <br><br>叠加方法<br><br><br><br> <br><br>
请了解 [顶级包含文件](https://helpx.adobe.com/experience-manager/kb/ams-dispatcher-manual/explanation-config-files.html#include-order) 因为这将是您进行任何自定义的起始位置。  首先，我们有一个简单的示例，其中我们希望添加一个我们打算指向此调度程序的新域名。  我们将使用的域示例为 <b>we-retail.adobe.com。 </b> 我们首先会将现有配置文件复制到一个新的配置文件中，以便添加更改：
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cp` `/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost``/etc/httpd/conf``.d``/available_vhosts/weretail_publish``.vhost` |
| --- | --- |

<br><br><br><br><br> <br><br>
我们复制了 *aem_publish.vhost* 因为它已经具备了让事情运转起来所需的功能，我们不想重新发明一个已经很强劲的开始。  现在，我们编辑新 *weretail.vhost* 文件，并进行所需的更改。

之前:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7<br>  8<br>  9<br>  10<br>  11<br>  12<br>  13 | `VirtualHost *:80``    ``ServerName    publish``    ``ServerAlias    ${PUBLISH_DEFAULT_HOSTNAME}``    ``DocumentRoot    ${PUBLISH_DOCROOT}``    ``IfModule mod_headers.c``            ``Header always add X-Dispatcher ${DISP_ID}``            ``Header always add X-Vhost "publish"``            ``Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"``            ``Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"``        ``Header append Vary User-Agent env=!dont-vary``    ``/IfModule``....... SNIP.......``/VirtualHost` |
| --- | --- |

<br><br><br><br><br> <br><br>
之后：
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7<br>  8<br>  9<br>  10<br>  11<br>  12<br>  13 | `VirtualHost *:80``    ``ServerName    weretail-publish``    ``ServerAlias    we-retail.adobe.com``    ``DocumentRoot    ${PUBLISH_DOCROOT}``    ``IfModule mod_headers.c``            ``Header always add X-Dispatcher ${DISP_ID}``            ``Header always add X-Vhost "werteail-publish"``            ``Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"``            ``Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"``        ``Header append Vary User-Agent env=!dont-vary``    ``/IfModule``....... SNIP.......``/VirtualHost` |
| --- | --- |

<br><br><br><br><br> <br><br>
现在，我们更新了ServerName和ServerAlias以匹配新的域名，并更新了其他痕迹导航标头。  现在，让我们启用新文件，以便Apache知道使用我们的新文件：
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cd` `/etc/httpd/conf``.d``/enabled_vhosts/``;``ln` `-s ..``/available_vhosts/weretail_publish``.vhost .` |
| --- | --- |

<br><br><br><br><br> <br><br>
现在，Apache Webserver知道域是某些内容应该会产生流量，但我们仍需要通知调度程序模块，它有一个新的域名可供遵循。  我们将首先创建一个新的\*_vhost.any文件 <b>/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any</b> 在文件中，我们将输入我们要遵循的域名：
<br><br><br><br><br> <br><br><br><br>

| 1 | `"we-retail.adobe.com"` |
| --- | --- |

<br><br><br><br><br> <br><br>
现在，我们需要创建一个新的场文件，该文件将使用我们的新vhost条目文件，我们将首先将一个强启动文件复制到我们自己的新文件。
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cp` `/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any``/etc/httpd/conf``.dispatcher.d``/available_farms/400_weretail_publish_farm``.any` |
| --- | --- |

<br><br><br><br><br> <br><br>
显示对此场文件进行的更改

之前:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6 | `/publishfarm { ``    ``/virtualhosts {``        ``$include "/etc/httpd/conf.dispatcher.d/vhosts/ams_publish_vhosts.any"``    ``}``........SNIP.........``}` |
| --- | --- |

<br><br><br><br><br> <br><br>
之后：
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6 | `/weretailpublishfarm { ``    ``/virtualhosts {``        ``$include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any"``    ``}``........SNIP.........``}` |
| --- | --- |

<br><br><br><br><br> <br><br>
现在，我们更新了场名称，并将其包含在场配置的/virtualhosts部分中。  我们需要启用此新场文件，以便它能够在运行配置中使用：
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cd` `/etc/httpd/conf``.dispatcher.d``/enabled_farms/``;``ln` `-s ..``/available_farms/400_weretail_publish_farm``.any .` |
| --- | --- |

<br><br><br><br><br> <br><br>
现在，我们只需重新加载Web服务器服务并使用我们的新域！

注释：

请注意，我们仅更改了更改和利用基线配置文件附带的现有包含和代码所需的部分。  我们只需要勾勒出我们需要改变的要素。  使事项更轻松，并且允许我们维护更少的代码

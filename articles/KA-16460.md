---
title: “如何重新索引同步 AEM 索引 | AEM，Oak”
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: "Helpx Link: helpx.adobe.com/experience-manager/kb/how-to-reindex-a-synchronous-AEM-index-AEM-Oak.html"
bug: false
article-created-by: Emily Geary
article-created-date: "3/17/2021 9:19:48 PM"
article-published-by: Emily Geary
article-published-date: "3/17/2021 9:21:41 PM"
version-number: 2
article-number: KA-16460
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=3613fb7d-6687-eb11-a812-000d3a593216"
exl-id: 1209609f-84a9-4810-b7c8-1193b09f82d7
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: ht
source-wordcount: '412'
ht-degree: 100%

---

# 如何重新索引同步 AEM 索引 | AEM，Oak

## 描述


如何正确地重新索引同步 Oak 索引而不导致停机？


## 分辨率


通过简单地将 reindex 属性设置为 true 来重新索引同步索引会导致同步操作，这可能会导致 Oak 实例挂起。为了避免这种情况，将索引发送到后台线程。为此，请执行以下步骤：

<b>步骤 1：</b>在后台线程中重新索引

1. 在要启用异步索引的属性索引的索引定义上从 CRXDE Lite 设置以下属性 – `/oak:index/property` 索引

   `reindex=true`

   `reindex-async=true`
2. 要验证上述是否刷新了节点，应该设置 `async="async-reindex"`。
3. 在 `PropertyIndexAsyncReindex` MBean 上调用`startPropertyIndexAsyncReindex`。这将启动搜索此类索引的后台作业。调用后，您应该会看到一条日志行重新索引将被执行...
4. 一旦重新索引完成，重新索引标志将被重置为 false。
5. 重新调用步骤 3 以将索引更改回同步索引。 如果未删除异步标志，则可能必须多次调用 Mbean（如果同时发生影响此索引的更改，则可能会发生这种情况）。



*注意：*&#x200B;只有 `async="async-reindex"` 将被移除，因为它控制索引将发生在哪个线程上。该 `reindex-async` 属性只是一个不会自动更改的配置标志。 有个办法是您为控制所有未来重新索引的特定索引定义设置一次该属性。则它预计会保持，您就不需要再次触控。


<b>第 2 步：</b>移除重新索引检查点（仅限 AEM 6.2 和更早版本）

在异步重新索引的过程中，会创建一个存储库检查点。索引任务完成后，必须按如下所述将其释放，确保以后顺利进行修订垃圾收集：

1. 首先，打开 CheckpointManager MBean：

   MongoMK - [/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3DDocument+node+store+checkpoint+management%2Ctype%3DCheckpointManger](http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3DDocument+node+store+checkpoint+management%2Ctype%3DCheckpointManger)

   TarMK - [/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3DSegment+node+store+checkpoint+management%2Ctype%3DCheckpointManger](http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3DSegment+node+store+checkpoint+management%2Ctype%3DCheckpointManger)
2. 调用 `listCheckpoints()` 操作
3. 通过 `name=async-reindex` 属性找到检查点行。
4. 将其 id 值复制到剪贴板

   在 MongoMK，它类似于：`r1234567aaaa-0-1`

   在 TarMK，它类似于：`6eac07d0-fe27-4d16-82f8-6d5da4cefd67`
5. 然后打开 `releaseCheckpoint()` 操作。
6. 将复制的 id 粘贴为 p1，然后单击“调用”。
7. 此步骤将释放检查点。

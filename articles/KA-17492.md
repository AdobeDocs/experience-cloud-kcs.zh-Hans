---
title: 分析AEM索引问题
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:47:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/6/2022 9:04:25 AM
version-number: 1
article-number: KA-17492
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=846ba2fc-9632-ec11-b6e5-000d3a5ba97a
exl-id: 59a10140-0386-42f8-bd1a-a934a2276ca5
source-git-commit: 1c09d3c2f1f02c0a93586735779e91b9f40a7f7e
workflow-type: tm+mt
source-wordcount: '507'
ht-degree: 0%

---

# 分析AEM索引问题

## 描述


本文旨在提供有关如何解决所有常见索引问题的详细信息。


## 分辨率

<br><br>分析慢速查询<br><br><br><br> <br><br>
转到 [!UICONTROL 工具] - [!UICONTROL 操作] - [!UICONTROL 功能板] - [!UICONTROL 诊断] - [!UICONTROL 查询性能] 将显示慢速查询列表。

请参阅 [本文档](https://docs.adobe.com/docs/en/aem/6-2/deploy/platform/queries-and-indexing.html#Troubleshooting%20indexing%20issues) 以了解有关分析慢速查询的详细信息。

在非生产环境中，可以安装ACS AEM工具包，以提供解释查询工具以供进一步调试。
<br><br><br><br> <br><br>重新索引异步索引<br><br><br><br><br><br>
注意：

重新索引通常不会解决查询问题，例如查询无法返回正确的结果。 此外，重新索引可能需要很长时间，除非此处列出的原因涵盖了重新索引，否则将避免重新索引。
<br><br><br><br> <br><br>
<b>如何重新索引异步索引</b>

- 登录AEM实例
- Open `http://aemhost:port/crx/de/index.jsp`
- 浏览到 `/oak:index`
- 设置布尔属性 `reindex=true` 在要重新编入索引的索引上，保存。 在开始索引时，您会看到如下日志消息：

```
23.06.2015 14:26:23.070 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes: /oak:index/cqAcUUID, /oak:index/nodetype, /oak:index/deviceIdentificationMode, /oak:index/campaignpath, /oak:index/active, /oak:index/jcrFrozenMixinTypes
```

- 正在重新索引时，`status`&#39;属性 `IndexStatsMBean` 将具有值&#39;`running`&#39;。

```
 23.06.2015 14:26:23.517 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing Traversed #10000 /jcr:system/jcr:versionStorage/c8/5f...23.06.2015 14:28:51.999 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report    - /oak:index/counter\*(708)    - /oak:index/authorizables\*(159)    - /oak:index/cqPageLucene\*(1913)    - /oak:index/ntBaseLucene\*(444)    - /oak:index/cqTagLucene\*(512)    - /oak:index/workflowDataLucene\*(116)
```

- 您可以通过检查索引定义节点（属性）来确认已完成索引 `reindexCount` 应已递增，并且应将重新索引布尔值设置为“`false`&quot;

   在日志文件中，如果成功完成索引，将显示以下条目

```
23.06.2015 14:28:52.009 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Reindexing (async) completed for indexes: /oak:index/counter\*(708), /oak:index/authorizables\*(159), /oak:index/cqPageLucene\*(1913), /oak:index/ntBaseLucene\*(444), /oak:index/cqTagLucene\*(512), /oak:index/workflowDataLucene\*(116) in 30.36 s
```

- 如果重新索引未完成且陷入循环，请查看 [下方](https://helpx.adobe.com/experience-manager/kb/Analyzing-AEM-Indexing-Issues.html#Analyzing_Failed_Reindexing).


通过在“信息”级别上拖动，可以识别异步索引活动 `org.apache.jackrabbit.plugins.index.IndexUpdate` 和 `org.apache.jackrabbit.plugins.index.AsyncIndexUpdate`.
 <br><br>异步索引性能问题<br><br><br><br> 
- 启用日志记录以验证时间：


TRACE级别（仅在Oak 1.0.17或更高版本中）：

```
org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.perf
```

调试级别：

```
org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate

org.apache.jackrabbit.oak.plugins.index.IndexUpdate

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor

org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext

org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier
```

将生成如下日志，显示索引的时间：

```
09.07.2015 08:13:38.401 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 Adding node /content/dam/site/test/jackrabbit-oak7.png
09.07.2015 08:13:38.583 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 save
09.07.2015 08:13:42.823 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Running background index task async
09.07.2015 08:13:42.963 \*TRACE\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor /oak:index/lucene Indexed document for /content/dam/site/test/jackrabbit-oak7.png/jcr:content/related is Documentstored,indexed,omitNorms,indexOptions=DOCS_ONLY:path:/content/dam/site/test/jackrabbit-oak7.png/jcr:content/related indexed,tokenized:fulltext:related
09.07.2015 08:13:43.579 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report
```

- `/oak:index/siteDamIndex(2)`
- `/oak:index/lucene(15)`

```
09.07.2015 08:13:43.779 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/siteDamIndex Index found to be updated. Reopening the IndexNode took 150ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier.perf /oak:index/lucene Copied 0 files totaling 0 B took 1465ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier /oak:index/lucene opening remote only file segments.gen
09.07.2015 08:13:45.361 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/lucene Index found to be updated. Reopening the IndexNode took 1581ms
```

- 获取一系列线程转储并搜索包含的线程 `AsyncIndexUpdate` 在堆栈中查看索引时间的大部分花费在何处，或索引是否正在等待某些其他线程。 要获取线程转储，请参阅 [本文](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html).
- 设置布尔属性 `saveDirectoryListing=true` （仅当使用Oak 1.0.16时，如果不需要更高版本）并设置属性 `excludedPaths=/var`, `/etc/workflow/instances`, `/jcr:system` 在 `/oak:index/lucene` OOTB索引以优化它。
- 单击“全部保存”
- 创建自定义lucene属性索引时，请确保设置 `saveDirectoryListing=true` （布尔）如果使用Oak 1.0.16并设置 `includedPaths` （字符串）属性，用于将索引限制为仅对特定路径进行索引。


转到此URL `/system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService` “读取时复制”、“写入时复制”（仅在Oak 1.0.18及更高版本中使用安全）和“预取索引文件”（仅在Oak 1.0.18及更高版本中使用）
<br><br><br>分析失败的重新索引<br><br><br><br>
- 当异步索引失败时，当您检查异步索引器统计资料JMX UI（下面的链接）时，您会看到 `LastIndexedTime` 是旧的日期和时间：

```
http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aid%3D11%2Cname%3D"async"%2Ctype%3D"IndexStats"
```

- 此外，当重新索引失败时，它会进入如下循环：

```
08.01.2015 01:22:04.474 \*INFO\* pool-9-thread-2 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 01:52:08.365 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 09:33:23.306 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified
```

- 如果您看到该消息，则应为 `org.apache.jackrabbit.oak.plugins.index`


- 下次索引循环时，其上方的调试日志消息上方会显示日志消息，这将提供更多有关索引失败原因的详细信息。  然后，您可以解决该问题，无论该问题是损坏的节点、缺少blob还是其他问题。

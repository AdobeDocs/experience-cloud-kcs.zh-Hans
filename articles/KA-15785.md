---
title: Campaign ClassicV7 — 优化数据库更新向导中生成的SQL查询
description: 描述
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Marta Zator
article-created-date: 5/5/2022 10:16:35 AM
article-published-by: Marta Zator
article-published-date: 5/5/2022 10:18:58 AM
version-number: 2
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e810bb6a-5ccc-ec11-a7b5-6045bd00dbbc
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '318'
ht-degree: 1%

---

# Campaign ClassicV7 — 优化数据库更新向导中生成的SQL查询

## 描述


<b>背景和上下文：</b>
在 [!DNL Campaign] 内部版本 [!DNL Gold Standard] 9032，则在向现有架构添加新列时，我们可能会遇到多个问题。

本文的范围是解决与以下内容相关的一个具体问题：

- 在记录已存在时向现有架构添加整数字段。
- 将应用程序生成的SQL查询优化为Postgres SQL的有效查询。


<b>用例：</b> 
<br>我们有一个现有的收件人表或任何其他表，其中已有超过100万条记录。
<br>现在，我们需要向该表添加一个数据类型为整数的额外列。
<br>我们在模式定义中添加该列，并希望提交数据库中的更改。

<b>挑战 </b>:
<br>我们在更新数据库时遇到和出现问题，数据库遇到死锁或查询阻止其他操作。
<br>这主要是由于根据数据库向导生成的SQL命令将所有记录更新为0。


<br> <br>

## 分辨率


解决方案 :

添加整数列时，我们将获取如下生成的SQL语句：

```
ALTER TABLE NmsRecipient ADD column_name SMALLINT;
UPDATE NmsRecipient SET column_name = 0;
ALTER TABLE NmsRecipient ALTER COLUMN column_name SET Default 0;
ALTER TABLE NmsRecipient ALTER COLUMN icolumn_name SET NOT NULL;
```

这里的问题是，数据库中并行执行了4个命令，这可能导致性能问题或死锁。

解决方案是将这4个命令压缩为一个命令，并且仍会执行与下面相同的更改：

```
ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0 ;
```

它执行所有所需的更改，添加列，设置默认值，设置 `NOT NULL`，以及将现有记录的值设置为0，因为 `NOT NULL` 约束。



<b>注意 :</b>

如果需要添加多个整数列，请逐个添加，然后针对每次更改运行数据库向导。

这是为了确保顺利操作，因为语句更新了所有 <b>现有 </b>记录为0，取决于否。 记录会花时间。

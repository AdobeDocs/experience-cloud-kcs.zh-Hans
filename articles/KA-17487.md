---
title: 使用和了解变量
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:36:09 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:51:43 PM
version-number: 1
article-number: KA-17487
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=1280b65e-9532-ec11-b6e5-000d3a5ba97a
exl-id: 86b5580e-134f-40d7-a126-45a38b8beaec
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '926'
ht-degree: 1%

---

# 使用和了解变量

## 描述


本文档将介绍如何在 [!DNL Apache] Web服务器和调度程序模块配置文件中的Web服务器。
<br><br><br><br>变量<br><br><br><br> <br><br>
[!DNL Apache] 支持变量自4.1.9版起 [!DNL Dispather] 模块也支持它们！

我们可以利用这些工具执行大量有用的操作，例如：

- 确保特定于环境的任何内容不在配置中内联，而是已提取，以确保开发中的配置文件在具有相同功能输出的生产环境中工作。
- 切换功能并更改AMS提供的不可变文件的日志级别，并且不允许您进行更改。
- 根据变量(如 `RUNMODE` 和 `ENV_TYPE`
- 匹配 `DocumentRoot`s和 `VirtualHost` 之间的DNS名称 [!DNL Apache] 配置和模块配置。



## 分辨率

<br><br>使用基线变量<br><br><br><br> <br><br>
由于AMS基线文件是只读的和不可变的，因此有一些功能可以切换为打开和关闭，以及通过编辑它们使用的变量进行配置。
<br><br><br><br> <br><br>基线变量<br><br><br><br> <br><br>
以下是文件内容的示例 <b>`/etc/httpd/conf.d/variables/ams_default.vars`</b>
<br><br><br><br><br> <br><br><br><br>

` Define DISP_LOG_LEVEL info Define AUTHOR_WHITELIST_ENABLED 0 Define PUBLISH_WHITELIST_ENABLED 0 Define AUTHOR_FORCE_SSL 1 Define PUBLISH_FORCE_SSL 0 `

<br><br><br><br><br> <br><br>示例1 — 强制SSL<br><br><br><br> <br><br>
上面显示的变量 <b>`AUTHOR_FORCE_SSL`</b>或 <b>`PUBLISH_FORCE_SSL`</b> 可以设置为1以引入重写规则，这些规则会在最终用户通过http请求进入时强制将其重定向到https

以下是允许此切换的配置文件语法：
<br><br><br><br><br> <br><br><br><br>

`/VirtualHost *:80      IfModule mod_rewrite.c          ReWriteEngine    on          If "${PUBLISH_FORCE_SSL} == 1" Include /etc/httpd/conf.d/rewrites/forcessl_rewrite.rules          /If      /IfModule /VirtualHost`

<br><br><br><br><br> <br><br>
如您所见，重写规则包括具有重定向最终用户浏览器的代码的内容，但设置为1的变量是允许使用或不使用文件的内容
<br><br><br><br> <br><br>示例2 — 日志记录级别<br><br><br><br> <br><br>
变量 <b>`DISP_LOG_LEVEL`</b> 可用于设置您希望对运行配置中实际使用的日志级别拥有的内容。

以下是ams基线配置文件中存在的语法示例：
<br><br><br><br><br> <br><br><br><br>

`IfModule disp_apache2.c      DispatcherLog    logs/dispatcher.log      DispatcherLogLevel ${DISP_LOG_LEVEL} /IfModule`

<br><br><br><br><br> <br><br>
如果您需要提高调度程序日志记录级别，只需更新 `ams_default.vars` 变量 <b>`DISP_LOG_LEVEL`</b> 达到你想要的水平。

示例值可以是整数或单词：
<br><br><br><br> <br>

| 日志级别 | 整数值 | 字值 |
| --- | --- | --- |
| 跟踪 | 4 | trace |
| 调试 | 3 | 调试 |
| 信息 | 2 | 信息 |
| Warning | 1 | 警告 |
| 错误 | 0 | error |

<br><br><br> <br><br>示例3 — 白名单<br><br><br><br> <br><br>
变量 <b>`AUTHOR_WHITELIST_ENABLED`</b> 和 <b>`PUBLISH_WHITELIST_ENABLED`</b> 可设置为1以包含重写规则，该规则包含允许或禁止基于IP地址的最终用户流量的规则。  打开此功能时，需要将创建白名单规则文件并将其包含在内。

以下是一些语法示例，说明变量如何启用包含白名单文件和白名单文件示例

<b>`sample.vhost`:</b>
<br><br><br><br><br> <br><br><br><br>

`VirtualHost *:80      Directory /          If "${AUTHOR_WHITELIST_ENABLED} == 1"              Include /etc/httpd/conf.d/whitelists/*_whitelist.rules          /If      /Directory /VirtualHost`

<br><br><br><br><br> <br><br>
<b>`sample_whitelist.rules`</b>:
<br><br><br><br><br> <br><br><br><br>

`RequireAny    Require ip 10.43.0.10/24 /RequireAny`

<br><br><br><br><br> <br><br>
如您所见 *`sample_whitelist.rules`* 强制实施IP限制，但切换变量允许将其包含在 *`sample.vhost`*
<br><br><br><br> <br><br>变量放置位置<br><br><br><br> <br><br>Web服务器启动参数<br><br><br><br> <br><br>
AMS会将全局变量置于的启动参数中 [!DNL Apache] 文件内的进程 <b>`/etc/sysconfig/httpd`</b>

此文件中预先定义了变量，如下所示：
<br><br><br><br><br> <br><br><br><br>

AUTHOR_IP=&quot;10.43.0.59&quot; AUTHOR_PORT=&quot;4502&quot; AUTHOR_DOCROOT=&#39;/mnt/var/www/author&#39; PUBLISH_IP=&quot;10.43.0.20&quot; PUBLISH_PORT=&quot;4503&quot; PUBLISH_DOCROOT=&#39;/mnt/vrww/html&#39;ENV_TYPE=&#39;dev&#39; RUNMODE=&#39;dev&#39;

<br><br><br><br><br> <br><br>
这些文件不是您可以更改的，但在配置文件中非常有用

注释：

由于仅在服务启动时才包含此文件。  需要重新启动服务才能进行更改。  这意味着重新加载是不够的，而是需要重新启动


<br><br><br><br> <br><br>变量文件(`.vars`)<br><br><br><br> <br><br>
由您的代码提供的自定义变量应位于*中`.vars`*目录中的文件 <b>`/etc/httpd/conf.d/variables/`</b>

这些文件可以包含您需要的任何自定义变量，并且在以下示例文件中可以看到一些语法示例

<b>`/etc/httpd/conf.d/variables/weretail_domains_dev.vars`</b>:
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN dev.weretail.com Define WERETAIL_ALT_DOMAIN dev.weretail.net`

<br><br><br><br><br> <br><br>
<b>`/etc/httpd/conf.d/variables/weretail_domains_stage.vars`:</b>
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN stage.weretail.com` `Define WERETAIL_ALT_DOMAIN stage.weretail.net`


<br><br><br><br><br> <br><br>
<b>`/etc/httpd/conf.d/variables/weretail_domains_prod.vars`</b>:
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN www.weretail.com Define WERETAIL_ALT_DOMAIN www..weretail.net`

<br><br><br><br><br> <br><br>
在创建自己的变量文件时，根据变量文件的内容对它们进行命名，并遵循手册中提供的命名标准 [此处](https://helpx.adobe.com/experience-manager/kb/ams-dispatcher-manual/explanation-config-files.html#naming-convention).  在上例中，您可以看到变量文件将不同的DNS条目作为变量托管在配置文件中。
<br><br><br><br> <br><br>使用变量<br><br><br><br> <br><br>
现在，您已在变量文件中定义了变量，接下来您将需要了解如何在其他配置文件中正确使用这些变量。

我们举个例子 `.vars` 文件，以说明正确的用例。

我们希望全局包含所有基于环境的变量，我们将创建文件 <b>`/etc/httpd/conf.d/000_load_env_vars.conf`</b>

`Include /etc/httpd/conf.d/variables/*_${ENV_TYPE}.vars Include /etc/httpd/conf.d/variables/*_${RUNMODE}.vars`

<br><br><br><br><br> <br><br>
我们知道，当httpd服务启动时，它会提取AMS在 <b>`/etc/sysconfig/httpd`</b> 和的变量集为 <b>`ENV_TYPE`</b> 和 <b>`RUNMODE`</b>

当此全局 `.conf` 文件会提前提取，因为文件的包含顺序 `conf.d` 文件名中的字母数字加载顺序为000，这将确保加载顺序早于目录中的其他文件。

include语句在文件名中也使用变量。  这可以根据 `ENV_TYPE` 和 `RUNMODE` 变量。

如果 *`ENV_TYPE`* 值 <b>`dev`</b> 然后使用的文件是：

<b>`/etc/httpd/conf.d/variables/weretail_domains_dev.vars`</b>

如果 *`ENV_TYPE`* 值 <b>`stage`</b> 然后使用的文件是：

<b>`/etc/httpd/conf.d/variables/weretail_domains_stage.vars`</b>

如果 `RUNMODE` 值 <b>`preview`</b> 然后使用的文件是：

<b>`/etc/httpd/conf.d/variables/weretail_domains_preview.vars`</b>

当该文件被包含在内时，它将允许我们使用存储在内的变量名称。

在 <b>`/etc/httpd/conf.d/available_vhosts/weretail.vhost`</b> 文件可以交换仅适用于dev的常规语法：


```
VirtualHost *:80      ServerName    dev.weretail.com      ServerAlias    dev.weretail.net |
```

使用新语法，该语法使用变量的强大功能来用于dev、stage和prod:

```
VirtualHost *:80      ServerName    ${WERETAIL_DOMAIN}      ServerAlias    ${WERETAIL_ALT_DOMAIN}
```


在 <b>`/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any`</b> 文件可以交换仅适用于dev的常规语法：


```
"dev.weretail.com" "dev.weretail.net"
```


使用变量的强大功能用于dev、stage和prod的新语法：


```
"${WERETAIL_DOMAIN}" "${WERETAIL_ALT_DOMAIN}" 
```

<br><br><br><br><br> <br><br>
这些变量在个性化运行设置时会有大量的重复使用，而无需在每个环境中部署不同的文件。  实际上，您可以使用变量来模板配置文件，并包含基于变量的文件。

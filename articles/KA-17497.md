---
title: “AEM Dispatcher缓存哪些请求？”
description: 描述
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS， AEM dispatcher，缓存， AEM, HTTP请求"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "3/23/2023 8:59:59 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "3/23/2023 9:07:34 PM"
version-number: 3
article-number: KA-17497
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=f11495a9-bdc9-ed11-b597-6045bd006b4b"
source-git-commit: fed544ddac29ee57604bf63dad5d301498def8b5
workflow-type: tm+mt
source-wordcount: '442'
ht-degree: 8%

---

# AEM Dispatcher缓存哪些请求？

## 描述 {#description}


<b>环境</b>

AEM Dispatcher 4.3.3

<b>问题</b>

本文可确定AEM Dispatcher为何不缓存HTTP请求/响应。
<br><br> <br>

## 解决方法 {#resolution}


本文档介绍了影响通过AEM Dispatcher模块的请求和响应的缓存能力的最重要方案。 未涵盖所有缓存规则。

<b>HTTP请求和缓存规则</b>

要使调度程序可缓存HTTP请求，它必须遵循以下规则：

1. URL是绝对的(不适用于。 或……)，具有文件扩展名，且URL中的文件名可用作文件系统上的文件。

   相关日志消息：


   ```
   URI not canonical: %s.
   
   Unable to map URI to file: %s.
   
   cache file path too long
   
   temporary file path too long
   
   request URL has no extension
   ```



   示例：


   | `/content/test` | 未缓存 |
   | --- | --- |
   | `/content/test.html` | cached |


2. 第一个文件扩展名后没有斜杠。

   相关日志消息：


   ```
   request URL has trailing slash
   ```



   示例：


   | `/content/test.html/` | 未缓存 |
   | --- | --- |
   | `/content/test.html/foo.jpg` | 未缓存 |
   | `/content/test.html` | cached |


3. 它使用HTTPGET或HEAD方法。

   相关日志消息：


   ```
   request method is neither GET nor HEAD
   ```



   示例：


   | `HEAD /content/test.html HTTP/1.1` | cached |
   | --- | --- |
   | `GET /content/dam/test.jpg HTTP/1.1` | 未缓存 |
   | `POST /content/test.html HTTP/1.1` | 未缓存 |


4. 调度程序中定义的/CACHE = /RULES拒绝该请求。 任何场配置。

   相关日志消息：


   ```
   URI not  in cache rules: %s request URL not in cache rules
   ```



   示例：


   | <br><br>    ```<br>    Farm has /cache = /rules and a request is received for /content/test.html<br>    <br>    /cache<br>    <br>    {<br>    <br>     ...<br>    <br>     /rules<br>    <br>     {<br>    <br>      /0001 {<br>    <br>      type "deny"<br>    <br>      glob "*"<br>    <br>      }<br>    <br>     }<br>    <br>    }<br>    ```<br><br> | 未缓存 |
   | --- | --- |
   | <br><br>    ```<br>    Farm has /cache = /rules and a request is received for /content/test.html<br>    <br>    /cache<br>    <br>    {<br>    <br>     ...<br>    <br>     /rules<br>    <br>     {<br>    <br>      /0001 {<br>    <br>      type "allow"<br>    <br>      glob "*"<br>    <br>      }<br>    <br>     }<br>    <br>    }<br>    ```<br><br> | cached |


5. HTTP请求不包含授权标头，或者包含标头，但在场配置中，/ALLOWAUTHORIZED设置为1。

   相关日志消息：


   ```
   request contains authorization
   ```



   示例：


   | HTTP请求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1<br>    Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>    <br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /cache {<br>      <br>     /allowAuthorized “0”<br>    }<br>    ```<br><br> | 未缓存 |
   | --- | --- |
   | HTTP请求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1<br>    Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>    <br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /cache {<br>      <br>     /allowAuthorized “1”<br>    }<br>    ```<br><br> | cached |


6. HTTP请求在COOKIE标头中包含LOGIN-TOKEN或AUTHORIZATION COOKIE，或者它包含（或同时包含）这些COOKIE中的任意一个（或两个），并且/ALLOWAUTHORIZED在场配置中设置为1。

   相关日志消息：


   ```
   request contains authorization
   ```



   示例：


   | HTTP请求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1<br>    Cookie: login-token=…<br>    <br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /cache {<br>      <br>     /allowAuthorized “0”<br>    }<br>    ```<br><br> | 未缓存 |
   | --- | --- |
   | HTTP请求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1<br>    Cookie: authorization=YWxhZGRpbjpvcGVuc2VzYW1l<br>    <br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /cache {<br>      <br>     /allowAuthorized “0”<br>    }<br>    ```<br><br> | 未缓存 |
   | HTTP请求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1<br>    Cookie: login-token=…<br>    <br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /cache {<br>      <br>     /allowAuthorized “1”<br>    }<br>    ```<br><br> | cached |


7. URL中有一个QUERYSTRING参数，允许通过FARM的/IGNOREURLPARAMS配置忽略该参数。

   相关日志消息：


   ```
   request contains a query string
   ```



   示例：


   | HTTP请求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    Farm /cache configuration:<br>    <br>    /ignoreUrlParams {<br>     /0001 { /type “allow” /glob “*” }<br>    }<br>    ```<br><br> | cached |
   | --- | --- |
   | HTTP请求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    Farm /cache configuration:<br>    <br>    /ignoreUrlParams {<br>     /0001 { /type “deny” /glob “*” } <br>      <br>     /0001 { /type “allow” /glob “test” }<br>    }<br>    ```<br><br> | cached |
   | HTTP请求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /ignoreUrlParams {<br>    <br>     /0001 { /type “deny” /glob “*” } <br>      <br>     /0001 { /type “allow” /glob “q” }<br>    }<br>    ```<br><br> | 未缓存 |




<b>HTTP响应和缓存规则：</b>



如果满足以下条件，则可缓存从AEM返回的HTTP响应：

1. 调度程序能够从定义的“RENDERS”之一发送和接收200 OK响应。

   <b>注意：</b> 如果否 [/timeout](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=zh-Hans) 在/renders中设置，或者将其设置为0，则它将永远等待与AEM实例的连接，即使实例关闭也是如此。
相关日志消息：


   ```
   Unable to send request to remote server. Unable to receive response from remote server. Remote server returned: %s No backend available.
   ```



   示例：


   | HTTP请求：<br><br>    200 OK | cached |
   | --- | --- |
   | HTTP请求：<br><br>    404页面未找到 | 未缓存 |


2. 响应中不存在以下任何响应标头：

   - `Dispatcher: no-cache`
   - `Cache-control: no-cache`
   - `Pragma: no-cache`

   相关日志消息：


   ```
   Backend forbids caching: %s, sent: %s" response contains no_cache
   ```



   示例：


   | HTTP响应：<br><br>    200 OK<br><br>    调度程序：无缓存 | 未缓存 |
   | --- | --- |
   | HTTP响应：<br><br>    200 OK<br><br>    缓存控制：无缓存 | 未缓存 |
   | HTTP响应：<br><br>    200 OK<br><br>    Pragma:无缓存 | 未缓存 |
   | HTTP响应：<br><br>    200 OK | cached |


3. 内容长度值大于零字节。
相关日志消息：


   ```
   response content length is zero
   ```



   示例：


   | HTTP响应：<br><br>    200 OK<br><br>    Content-Length:0 | 未缓存 |
   | --- | --- |
   | HTTP响应：<br><br>    200 OK<br><br>    Content-Length:3120 | cached |



